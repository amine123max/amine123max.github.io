{{- /* Footer custom content area start */ -}}
{{- /*     Insert any custom code (web-analytics, resources, etc.) - it will appear in the <footer></footer> section of every page. */ -}}

{{- /* 加载搜索按钮脚本 */ -}}
{{ $searchJS := resources.Get "js/search-button.js" }}
{{ if $searchJS }}
  {{ $searchJS := $searchJS | minify | fingerprint }}
  <script src="{{ $searchJS.RelPermalink }}" integrity="{{ $searchJS.Data.Integrity }}"></script>
{{ end }}

{{- /* 加载语言切换脚本 */ -}}
{{ $langSwitch := resources.Get "js/lang-switch.js" }}
{{ if $langSwitch }}
  {{ $langSwitch := $langSwitch | minify | fingerprint }}
  <script src="{{ $langSwitch.RelPermalink }}" integrity="{{ $langSwitch.Data.Integrity }}"></script>
{{ end }}

{{- /* 加载移动端菜单脚本 */ -}}
{{ $mobileMenu := resources.Get "js/mobile-menu.js" }}
{{ if $mobileMenu }}
  {{ $mobileMenu := $mobileMenu | minify | fingerprint }}
  <script src="{{ $mobileMenu.RelPermalink }}" integrity="{{ $mobileMenu.Data.Integrity }}"></script>
{{ end }}

{{- /* 加载导航公用脚本 */ -}}
{{ $navShared := resources.Get "js/nav-shared.js" }}
{{ if $navShared }}
  {{ $navShared := $navShared | minify | fingerprint }}
  <script src="{{ $navShared.RelPermalink }}" integrity="{{ $navShared.Data.Integrity }}"></script>
{{ end }}

{{- /* 统一滚动条管理脚本 */ -}}
{{ $scrollbarManager := resources.Get "js/scrollbar-manager.js" }}
{{ if $scrollbarManager }}
  {{ $scrollbarManager := $scrollbarManager | minify | fingerprint }}
  <script src="{{ $scrollbarManager.RelPermalink }}" integrity="{{ $scrollbarManager.Data.Integrity }}"></script>
{{ end }}

{{- /* 横线动画已移除 */ -}}

{{- /* 不蒜子访问量统计 - 仅生产环境 */ -}}
<script>
  // 检测是否为localhost/127.0.0.1
  var isLocal = location.hostname === 'localhost' || 
                location.hostname === '127.0.0.1' || 
                location.hostname === '';
  
  if (isLocal) {
    // 开发环境：显示占位符，不加载不蒜子
    var pv = document.getElementById('busuanzi_value_site_pv');
    if (pv) pv.textContent = '999';
    console.log('开发环境：不蒜子已禁用，显示占位符');
  } else {
    // 生产环境：加载不蒜子
    window.addEventListener('load', function() {
      setTimeout(function() {
        var s = document.createElement('script');
        s.async = true;
        s.src = 'https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js';
        s.onerror = function() { 
          var pv = document.getElementById('busuanzi_value_site_pv');
          if (pv) pv.textContent = '--';
        };
        document.body.appendChild(s);
      }, 500);
    });
    
    {{- /* 不蒜子数字格式化 */ -}}
    {{ $busuanziFormat := resources.Get "js/busuanzi-format.js" }}
    {{ if $busuanziFormat }}
      {{ $busuanziFormat := $busuanziFormat | minify | fingerprint }}
      var fmt = document.createElement('script');
      fmt.src = '{{ $busuanziFormat.RelPermalink }}';
      document.head.appendChild(fmt);
    {{ end }}
  }
</script>

{{- /* 加载PDF生成库和脚本（仅在主页） */ -}}
{{ if .IsHome }}
  <!-- html2pdf.js CDN -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.9.3/html2pdf.bundle.min.js"></script>
  
  <!-- Resume PDF Generator - 动态加载 -->
  <script>
    (function() {
      let currentGenerator = null;
      
      function loadPDFGenerator(lang) {
        console.log('Loading PDF generator for language:', lang);
        
        // 移除旧的脚本
        if (currentGenerator) {
          document.head.removeChild(currentGenerator);
          currentGenerator = null;
        }
        
        // 加载新的脚本
        const script = document.createElement('script');
        script.type = 'text/javascript';
        
        if (lang === 'zh') {
          script.src = '/js/resume-pdf-generator-CN.js';
          console.log('✓ Loading Chinese PDF generator script');
        } else {
          script.src = '/js/resume-pdf-generator-EN.js';
          console.log('✓ Loading English PDF generator script');
        }
        
        script.onload = function() {
          console.log('PDF generator script loaded successfully');
          setTimeout(function() {
            if (lang === 'zh' && typeof window.initResumePDFGeneratorCN === 'function') {
              window.initResumePDFGeneratorCN();
            } else if (typeof window.initResumePDFGeneratorEN === 'function') {
              window.initResumePDFGeneratorEN();
            }
            
            if (!document.getElementById('cv-download-loaded')) {
              const downloadScript = document.createElement('script');
              downloadScript.src = '/js/cv-download.js';
              downloadScript.id = 'cv-download-loaded';
              document.head.appendChild(downloadScript);
              console.log('CV download script loaded');
            }
          }, 100);
        };
        
        document.head.appendChild(script);
        currentGenerator = script;
      }
      
      // 初始化
      function init() {
        const currentLang = localStorage.getItem('site-lang') || 'en';
        console.log('localStorage site-lang:', currentLang);
        loadPDFGenerator(currentLang);
      }
      
      // 监听语言切换事件
      window.addEventListener('languageChanged', function(e) {
        console.log('Language changed to:', e.detail.lang);
        loadPDFGenerator(e.detail.lang);
      });
      
      // 页面加载完成后初始化
      if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', init);
      } else {
        init();
      }
    })();
  </script>
{{ end }}

{{- /* Footer custom content area end */ -}}
